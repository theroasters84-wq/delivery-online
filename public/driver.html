<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver Panel - The Roasters</title>
    <style>
        body { font-family: sans-serif; text-align: center; background: #121212; color: white; padding: 20px; }
        .container { max-width: 400px; margin: auto; }
        
        /* ÎšÎ¿Ï…Ï„Î¹Î¬ ÎºÎ±Î¹ ÎºÎ¿Ï…Î¼Ï€Î¹Î¬ */
        input { padding: 15px; width: 80%; border-radius: 10px; border: 1px solid #444; background: #222; color: white; margin-bottom: 10px; font-size: 16px; }
        .btn-main { background: #00ff00; color: black; border: none; padding: 15px 30px; border-radius: 10px; font-weight: bold; width: 85%; cursor: pointer; font-size: 16px; }
        .btn-logout { background: #ff4444; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-top: 10px; font-size: 12px; }
        
        /* Î— ÎºÎ¬ÏÏ„Î± Ï„Î·Ï‚ Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±Ï‚ */
        .order-card { background: #1e1e1e; padding: 25px; border-radius: 20px; border: 4px solid #ff0000; margin-top: 20px; }
        .blink { animation: blinker 0.8s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }
    </style>
</head>
<body>

    <div class="container">
        <h1>The Roasters â˜•</h1>

        <div id="login-section">
            <p>Î Î¿Î¹Î¿Ï‚ Î½Ï„ÎµÎ»Î¹Î²ÎµÏÎ¬Ï‚ ÎµÎ¯ÏƒÎ±Î¹;</p>
            <input type="text" id="driver-name-input" placeholder="Î“ÏÎ¬ÏˆÎµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ¿Ï…...">
            <button class="btn-main" onclick="login()">Î•ÎÎ•Î¡Î“ÎŸÎ ÎŸÎ™Î—Î£Î— & Î—Î§ÎŸÎ£</button>
        </div>

        <div id="profile-section" style="display:none;">
            <h2 id="display-name" style="color:#00ff00; margin-bottom:5px;"></h2>
            <button class="btn-logout" onclick="logout()">Î‘Î›Î›Î‘Î“Î— ÎŸÎÎŸÎœÎ‘Î¤ÎŸÎ£ (LOGOUT)</button>
            <hr style="border:0; border-top:1px solid #333; margin:20px 0;">
            <p id="status">ğŸŸ¢ Î ÎµÏÎ¹Î¼Î­Î½Ï‰ Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±...</p>
        </div>

        <div id="orders-area"></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const alertAudio = new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3');
        
        // Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± ÏƒÎµÎ»Î¯Î´Î±Ï‚
        const loginSection = document.getElementById('login-section');
        const profileSection = document.getElementById('profile-section');
        const displayName = document.getElementById('display-name');
        const ordersArea = document.getElementById('orders-area');

        // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î®Î´Î· ÏŒÎ½Î¿Î¼Î± ÏƒÏ„Î· Î¼Î½Î®Î¼Î· Ï„Î¿Ï… ÎºÎ¹Î½Î·Ï„Î¿Ï
        let savedName = localStorage.getItem('driverName');
        if (savedName) {
            setupDriver(savedName);
        }

        function login() {
            const nameInput = document.getElementById('driver-name-input').value;
            if (!nameInput.trim()) return alert("Î’Î¬Î»Îµ Î­Î½Î± ÏŒÎ½Î¿Î¼Î±!");

            localStorage.setItem('driverName', nameInput);
            
            // Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î®Ï‡Î¿Ï… (ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒ Î³Î¹Î± Ï„Î± ÎºÎ¹Î½Î·Ï„Î¬)
            alertAudio.play().then(() => {
                alertAudio.pause();
                alertAudio.currentTime = 0;
            }).catch(e => console.log("Audio unlock failed"));

            setupDriver(nameInput);
        }

        function setupDriver(name) {
            loginSection.style.display = "none";
            profileSection.style.display = "block";
            displayName.innerText = "ÎÏ„ÎµÎ»Î¹Î²ÎµÏÎ¬Ï‚: " + name;
            
            // Î•Î½Î·Î¼ÎµÏÏÎ½Î¿Ï…Î¼Îµ Ï„Î¿Î½ server ÏŒÏ„Î¹ ÎµÎ¯Î¼Î±ÏƒÏ„Îµ online
            socket.emit('driver-login', name);
        }

        function logout() {
            if (confirm("Î˜Î­Î»ÎµÎ¹Ï‚ Î½Î± Î±Î»Î»Î¬Î¾ÎµÎ¹Ï‚ ÏŒÎ½Î¿Î¼Î±;")) {
                localStorage.removeItem('driverName');
                location.reload(); // Î‘Î½Î±Î½Î­Ï‰ÏƒÎ· Î³Î¹Î± Î½Î± Î³Ï…ÏÎ¯ÏƒÎµÎ¹ ÏƒÏ„Î· Ï†ÏŒÏÎ¼Î± ÎµÎ¹ÏƒÏŒÎ´Î¿Ï…
            }
        }

        // Î›Î®ÏˆÎ· Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±Ï‚
        socket.on('new-order', (data) => {
            alertAudio.loop = true;
            alertAudio.play();
            if (navigator.vibrate) navigator.vibrate([500, 300, 500, 300]);

            ordersArea.innerHTML = `
                <div class="order-card">
                    <h1 class="blink" style="color:red;">ğŸš¨ ÎÎ•Î‘ ÎšÎ›Î—Î£Î—!</h1>
                    <p>ÎÏÎ±: ${data.time}</p>
                    <button class="btn-main" onclick="acceptOrder()">Î‘Î ÎŸÎ”ÎŸÎ§Î— âœ…</button>
                </div>
            `;
            document.getElementById('status').innerText = "ğŸ”´ Î£Î• ÎšÎ‘Î›ÎŸÎ¥Î Î¤Î©Î¡Î‘!";
        });

        // Î‘ÎºÏÏÏ‰ÏƒÎ· Î±Ï€ÏŒ Ï„Î¿ Î¼Î±Î³Î±Î¶Î¯
        socket.on('order-cancelled', () => {
            stopSound();
            ordersArea.innerHTML = "<p style='color:orange;'>âš ï¸ Î— ÎºÎ»Î®ÏƒÎ· Î±ÎºÏ…ÏÏÎ¸Î·ÎºÎµ.</p>";
            setTimeout(() => { ordersArea.innerHTML = ""; document.getElementById('status').innerText = "ğŸŸ¢ Î ÎµÏÎ¹Î¼Î­Î½Ï‰ Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±..."; }, 3000);
        });

        function acceptOrder() {
            stopSound();
            const name = localStorage.getItem('driverName');
            socket.emit('order-accepted', { driverName: name });
            ordersArea.innerHTML = "";
            document.getElementById('status').innerText = "âœ… Î‘Ï€Î¿Î´Î­Ï‡Ï„Î·ÎºÎµÏ‚ Ï„Î·Î½ Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±!";
            setTimeout(() => { document.getElementById('status').innerText = "ğŸŸ¢ Î ÎµÏÎ¹Î¼Î­Î½Ï‰ Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±..."; }, 3000);
        }

        function stopSound() {
            alertAudio.pause();
            alertAudio.currentTime = 0;
        }
    </script>
</body>
</html>
