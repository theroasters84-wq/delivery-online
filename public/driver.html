<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Driver App - High Volume</title>
    <style>
        body { background: #000; color: white; font-family: sans-serif; text-align: center; margin: 0; padding: 20px; height: 100vh; display: flex; flex-direction: column; justify-content: center; overflow: hidden; }
        .card { background: #1e1e1e; padding: 30px; border-radius: 25px; border: 1px solid #333; }
        
        /* Î•Î Î™Î˜Î•Î¤Î™ÎšÎŸ BOT OVERLAY */
        #bot-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #000; z-index: 99999; display: flex; 
            flex-direction: column; align-items: center; justify-content: center; padding: 25px; box-sizing: border-box;
        }
        .bot-bubble { background: #007bff; color: white; padding: 25px; border-radius: 20px; margin-bottom: 20px; font-size: 1.2em; font-weight: bold; line-height: 1.4; border: 2px solid #fff; }
        .btn-action { background: #ffc107; color: black; padding: 25px; width: 100%; border-radius: 20px; font-weight: 900; font-size: 1.3em; border: none; cursor: pointer; text-transform: uppercase; margin-bottom: 15px; box-shadow: 0 5px 15px rgba(255,193,7,0.4); }
        .btn-confirm { background: #28a745; color: white; padding: 20px; width: 100%; border-radius: 20px; font-weight: bold; border: none; font-size: 1.1em; }

        input { width: 100%; padding: 18px; margin-bottom: 15px; border-radius: 12px; border: 1px solid #444; background: #111; color: white; font-size: 1.2em; box-sizing: border-box; }
        #accept-layer { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: #ff0000; color: white; display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 10000; animation: flash 0.4s infinite; }
        @keyframes flash { 0% { background: #ff0000; } 50% { background: #990000; } 100% { background: #ff0000; } }
    </style>
</head>
<body>

    <div id="bot-overlay">
        <div class="bot-bubble">ğŸ“¢ Î•ÎÎ•Î¡Î“ÎŸÎ ÎŸÎ™Î—Î£Î— Î—Î§ÎŸÎ¥ ÎšÎ‘Î™ ÎœÎ Î‘Î¤Î‘Î¡Î™Î‘Î£<br><small style="font-weight:normal; font-size: 0.8em;">Î ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï€Î±Ï„Î®ÏƒÎµÎ¹Ï‚ Ï„Î± ÎºÎ¿Ï…Î¼Ï€Î¹Î¬ Î³Î¹Î± Î½Î± Î±ÎºÎ¿ÏÏ‚ Ï„Î¹Ï‚ ÎºÎ»Î®ÏƒÎµÎ¹Ï‚.</small></div>
        
        <button class="btn-action" onclick="openSettings()">1. Î¡Î¥Î˜ÎœÎ™Î£Î— ÎœÎ Î‘Î¤Î‘Î¡Î™Î‘Î£</button>
        <button class="btn-confirm" onclick="unlockEverything()">2. Î•ÎÎ•Î¡Î“ÎŸÎ ÎŸÎ™Î—Î£Î— Î—Î§ÎŸÎ¥ & Î•Î™Î£ÎŸÎ”ÎŸÎ£</button>
    </div>

    <div id="accept-layer" onclick="handleAccept()">
        <h1 style="font-size: 5em; font-weight: 900;">Î•Î¡Î§ÎŸÎœÎ‘Î™!</h1>
        <p>Î Î‘Î¤Î‘ Î“Î™Î‘ Î‘Î ÎŸÎ”ÎŸÎ§Î—</p>
    </div>

    <div class="card" id="login-ui" style="display:none;">
        <h2>Î£Î¥ÎÎ”Î•Î£Î— ÎŸÎ”Î—Î“ÎŸÎ¥</h2>
        <input type="password" id="pw" placeholder="ÎšÏ‰Î´Î¹ÎºÏŒÏ‚">
        <input type="text" id="shop" placeholder="ÎœÎ±Î³Î±Î¶Î¯ (Ï€.Ï‡. roasters)">
        <input type="text" id="name" placeholder="Î¤Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ¿Ï…">
        <button class="btn-action" style="background:#00ff00; color:black;" onclick="login()">Î•ÎÎ‘Î¡ÎÎ— Î’Î‘Î¡Î”Î™Î‘Î£</button>
    </div>

    <div id="active-ui" style="display:none;">
        <h1 id="shop-title" style="color:#00ff00; font-size: 2.5em; margin-bottom:0;"></h1>
        <p id="driver-name-display" style="color:#aaa; font-size: 1.2em;"></p>
        <div style="margin: 40px 0; border: 2px solid #333; padding: 20px; border-radius: 20px;">
            <span style="font-size: 2em;">â—</span> <span style="font-size: 1.5em; font-weight:bold;">ONLINE</span>
        </div>
        <button onclick="logout()" style="background:none; border:none; color:#ff4757; text-decoration:underline; cursor:pointer;">Î‘Ï€Î¿ÏƒÏÎ½Î´ÎµÏƒÎ· / Î‘Î»Î»Î±Î³Î®</button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const alarm = new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg');
        
        // Î‘Ï…Ï„ÏŒ Ï„Î¿ ÎºÎ¿Ï…Î¼Ï€Î¯ Î¾ÎµÎºÎ»ÎµÎ¹Î´ÏÎ½ÎµÎ¹ Ï„Î¿Î½ Î®Ï‡Î¿ "Î²Î¯Î±Î¹Î±"
        function unlockEverything() {
            alarm.play().then(() => {
                alarm.pause();
                alarm.currentTime = 0;
                document.getElementById('bot-overlay').style.display = 'none';
                document.getElementById('login-ui').style.display = 'block';
                // Î–Î·Ï„Î¬Î¼Îµ Î¬Î´ÎµÎ¹Î± Î³Î¹Î± ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚ Î±Î¼Î­ÏƒÏ‰Ï‚
                enablePush();
            }).catch(e => {
                alert("Î Î¬Ï„Î± Î¾Î±Î½Î¬ Ï„Î¿ Ï€ÏÎ¬ÏƒÎ¹Î½Î¿ ÎºÎ¿Ï…Î¼Ï€Î¯ Î³Î¹Î± Î½Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î¿ Î®Ï‡Î¿Ï‚!");
            });
        }

        function openSettings() {
            alert("Î’ÏÎµÏ‚ Ï„Î¿ 'ÎœÏ€Î±Ï„Î±ÏÎ¯Î±' ÎºÎ±Î¹ Î²Î¬Î»Îµ 'Î§Ï‰ÏÎ¯Ï‚ Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿ÏÏ‚'.");
            window.location.href = "intent://settings/#Intent;action=android.settings.APPLICATION_DETAILS_SETTINGS;data=package:com.android.chrome;end";
        }

        window.onload = () => {
            if(localStorage.getItem('saved_pw')) document.getElementById('pw').value = localStorage.getItem('saved_pw');
            if(localStorage.getItem('saved_shop')) document.getElementById('shop').value = localStorage.getItem('saved_shop');
            if(localStorage.getItem('saved_name')) document.getElementById('name').value = localStorage.getItem('saved_name');
            
            // Î‘Î½ ÎµÎ¯Î½Î±Î¹ Î®Î´Î· logged in, Ï„Î¿ bot Î¼Î­Î½ÎµÎ¹ Î¼Î­Ï‡ÏÎ¹ Î½Î± Ï€Î±Ï„Î®ÏƒÎµÎ¹ "Unlock" Î³Î¹Î± Ï„Î¿Î½ Î®Ï‡Î¿
        };

        function login() {
            const p = document.getElementById('pw').value;
            const s = document.getElementById('shop').value.toLowerCase().trim();
            const n = document.getElementById('name').value.trim();
            if(!p || !s || !n) return alert("Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ Ï„Î± Ï€Î¬Î½Ï„Î±!");
            
            localStorage.setItem('saved_pw', p);
            localStorage.setItem('saved_shop', s);
            localStorage.setItem('saved_name', n);
            localStorage.setItem('is_logged_in', 'true');
            start();
        }

        function start() {
            document.getElementById('login-ui').style.display = 'none';
            document.getElementById('active-ui').style.display = 'block';
            document.getElementById('shop-title').innerText = localStorage.getItem('saved_shop').toUpperCase();
            document.getElementById('driver-name-display').innerText = localStorage.getItem('saved_name');

            socket.emit('driver-login', { 
                name: localStorage.getItem('saved_name'), 
                shop: localStorage.getItem('saved_shop') 
            });

            if ('wakeLock' in navigator) navigator.wakeLock.request('screen').catch(()=>{});
        }

        async function enablePush() {
            if ('serviceWorker' in navigator && 'PushManager' in window) {
                const register = await navigator.serviceWorker.register('/sw.js');
                const sub = await register.pushManager.subscribe({
                    userVisibleOnly: true,
                    applicationServerKey: 'BDeB-u_7Q0z5G_wL8k9Wz8Xp6F6R7T8Y9U0I1O2P3A4S5D6F7G8H9J0K_L1M'
                });
                socket.emit('save-subscription', sub);
            }
        }

        socket.on('new-order', () => {
            alarm.loop = true;
            alarm.play();
            document.getElementById('accept-layer').style.display = 'flex';
            if(navigator.vibrate) navigator.vibrate([1000, 500, 1000, 500, 1000]);
        });

        function handleAccept() {
            alarm.pause();
            alarm.currentTime = 0;
            socket.emit('order-accepted', { 
                driverName: localStorage.getItem('saved_name'), 
                shopName: localStorage.getItem('saved_shop') 
            });
            document.getElementById('accept-layer').style.display = 'none';
        }

        function logout() {
            localStorage.removeItem('is_logged_in');
            location.reload();
        }
    </script>
</body>
</html>
