<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop Panel - The Roasters</title>
    <link rel="manifest" href="/manifest-shop.json">
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; background: #f4f4f4; margin: 0; padding: 20px; }
        .card { max-width: 500px; margin: 20px auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .shop-badge { display: inline-block; background: #e67e22; color: white; padding: 10px 25px; border-radius: 50px; font-weight: bold; margin-bottom: 25px; cursor: pointer; font-size: 1.2em; }
        .driver { display: flex; justify-content: space-between; padding: 15px; border-bottom: 1px solid #eee; align-items: center; }
        .btn-call { background: #2ecc71; color: white; border: none; padding: 15px 25px; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 1em; }
        #status { margin-top: 25px; padding: 20px; border-radius: 12px; font-weight: bold; background: #ececec; color: #666; font-size: 1.3em; border: 2px dashed #ccc; }
        .ok { background: #27ae60 !important; color: white !important; border: 2px solid #1e8449 !important; }
    </style>
</head>
<body>
    <div class="card">
        <h2>ğŸ¢ Î Î¯Î½Î±ÎºÎ±Ï‚ Î¥Ï€ÎµÏÎ¸Ï…Î½Î·Ï‚</h2>
        <div class="shop-badge" id="display-shop-name" onclick="changeShop()">Î¦ÏŒÏÏ„Ï‰ÏƒÎ·...</div>
        <div id="list"><p>Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î½Ï„ÎµÎ»Î¹Î²ÎµÏÎ¬Î´Ï‰Î½...</p></div>
        <div id="status">Î•Î¤ÎŸÎ™ÎœÎŸ</div>
        <button onclick="changeShop()" style="margin-top:30px; background:none; border:none; color:gray; text-decoration:underline; cursor:pointer;">Î‘Î»Î»Î±Î³Î® ÎšÎ±Ï„Î±ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚</button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let currentShop = localStorage.getItem('activeShop') || "";

        function init() {
            if (!currentShop) {
                let name = prompt("ÎŒÎ½Î¿Î¼Î± Î¼Î±Î³Î±Î¶Î¹Î¿Ï;");
                if (!name) return location.reload();
                currentShop = name.toLowerCase().trim();
                localStorage.setItem('activeShop', currentShop);
            }
            document.getElementById('display-shop-name').innerText = currentShop.toUpperCase();
            socket.emit('join-shop', currentShop);
        }

        function changeShop() {
            if(confirm("Î‘Î»Î»Î±Î³Î®;")) { localStorage.removeItem('activeShop'); location.reload(); }
        }

        init();

        socket.on('update-drivers', (drivers) => {
            const list = document.getElementById('list');
            list.innerHTML = "";
            const ids = Object.keys(drivers);
            if (ids.length === 0) { list.innerHTML = "âŒ ÎšÎ±Î½Î­Î½Î±Ï‚ online"; return; }
            ids.forEach(id => {
                list.innerHTML += `<div class="driver"><span>ğŸ‘¤ ${drivers[id]}</span><button class="btn-call" onclick="callDriver('${id}', '${drivers[id]}')">ğŸ”” ÎšÎ›Î—Î£Î—</button></div>`;
            });
        });

        function callDriver(id, name) {
            socket.emit('call-driver', { driverId: id, shop: currentShop });
            document.getElementById('status').innerText = "ÎšÎ»Î®ÏƒÎ· ÏƒÎµ " + name + "...";
        }

        socket.on('driver-accepted', (data) => {
            const s = document.getElementById('status');
            s.innerText = "âœ… " + data.driverName.toUpperCase() + " Î•Î¡Î§Î•Î¤Î‘Î™!";
            s.classList.add('ok');
            setTimeout(() => { s.classList.remove('ok'); s.innerText = "Î•Î¤ÎŸÎ™ÎœÎŸ"; }, 8000);
        });
    </script>
</body>
</html>
