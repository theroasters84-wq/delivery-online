<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <title>Shop Panel</title>
    <link rel="manifest" href="/manifest.json">
    <style>
        body { font-family: sans-serif; text-align: center; background: #f4f4f4; }
        .card { max-width: 400px; margin: 20px auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .driver { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; align-items: center; }
        .btn-call { background: #e67e22; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
        #status { margin-top: 20px; padding: 15px; border-radius: 10px; font-weight: bold; background: #ddd; }
        .ok { background: #27ae60 !important; color: white; }
    </style>
</head>
<body>
    <div class="card">
        <h2 id="title">Shop</h2>
        <div id="list"></div>
        <div id="status">Î‘ÎÎ‘ÎœÎŸÎÎ—</div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const params = new URLSearchParams(window.location.search);
        let shopName = params.get('name');

        if(!shopName) {
            shopName = prompt("ÎŒÎ½Î¿Î¼Î± Î¼Î±Î³Î±Î¶Î¹Î¿Ï:").toLowerCase();
            window.location.search = `?name=${shopName}`;
        }

        document.getElementById('title').innerText = "ÎœÎ±Î³Î±Î¶Î¯: " + shopName.toUpperCase();

        socket.on('connect', () => {
            socket.emit('join-shop', shopName);
        });

        socket.on('update-drivers', (drivers) => {
            const list = document.getElementById('list');
            list.innerHTML = Object.keys(drivers).length === 0 ? "ÎšÎ±Î½Î­Î½Î±Ï‚ Online" : "";
            for (let id in drivers) {
                list.innerHTML += `
                    <div class="driver">
                        <span>ğŸ‘¤ ${drivers[id]}</span>
                        <button class="btn-call" onclick="call('${id}', '${drivers[id]}')">ÎšÎ›Î—Î£Î—</button>
                    </div>`;
            }
        });

        function call(id, name) {
            socket.emit('call-driver', { driverId: id, time: new Date().toLocaleTimeString(), shop: shopName });
            document.getElementById('status').innerText = "ÎšÎ±Î»Î¿ÏÎ¼Îµ: " + name;
        }

        socket.on('driver-accepted', (data) => {
            const s = document.getElementById('status');
            s.innerText = "âœ… " + data.driverName + " Î‘Î ÎŸÎ”Î•Î§Î¤Î—ÎšÎ•";
            s.classList.add('ok');
            new Audio('https://actions.google.com/sounds/v1/notifications/positive_notification.ogg').play();
            setTimeout(() => { s.classList.remove('ok'); s.innerText = "Î‘ÎÎ‘ÎœÎŸÎÎ—"; }, 7000);
        });
    </script>
</body>
</html>
