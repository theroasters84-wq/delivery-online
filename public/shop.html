<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop Panel - The Roasters System</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/924/924514.png">
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; background: #f4f4f4; margin: 0; padding: 20px; }
        .card { max-width: 500px; margin: 20px auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h2 { color: #333; margin-bottom: 5px; }
        .shop-badge { display: inline-block; background: #e67e22; color: white; padding: 5px 15px; border-radius: 50px; font-size: 0.9em; margin-bottom: 20px; cursor: pointer; }
        .driver { display: flex; justify-content: space-between; padding: 15px; border-bottom: 1px solid #eee; align-items: center; }
        .btn-call { background: #2ecc71; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-call:hover { background: #27ae60; transform: scale(1.05); }
        #status { margin-top: 25px; padding: 20px; border-radius: 12px; font-weight: bold; background: #ececec; color: #666; font-size: 1.2em; border: 2px dashed #ccc; }
        .ok { background: #27ae60 !important; color: white !important; border: 2px solid #1e8449 !important; animation: bounce 0.5s; }
        @keyframes bounce { 0%, 100% {transform: scale(1);} 50% {transform: scale(1.05);} }
        .btn-switch { background: none; border: 1px solid #ccc; color: #888; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8em; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="card">
        <h2>Î Î¯Î½Î±ÎºÎ±Ï‚ ÎšÎ±Ï„Î±ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚</h2>
        <div class="shop-badge" id="display-shop-name" onclick="changeShop()">Î¦ÏŒÏÏ„Ï‰ÏƒÎ·...</div>
        
        <div id="list">
            <p style="color: #999;">Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î½Ï„ÎµÎ»Î¹Î²ÎµÏÎ¬Î´Ï‰Î½...</p>
        </div>

        <div id="status">Î•Î¤ÎŸÎ™ÎœÎŸ Î“Î™Î‘ ÎšÎ›Î—Î£Î—</div>
        
        <button class="btn-switch" onclick="changeShop()">ğŸ”„ Î‘Î»Î»Î±Î³Î® ÎœÎ±Î³Î±Î¶Î¹Î¿Ï</button>
    </div>

    <audio id="success-sound" src="https://actions.google.com/sounds/v1/notifications/positive_notification.ogg"></audio>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const successSound = document.getElementById('success-sound');
        let currentShop = "";

        // Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Î³Î¹Î± ÎµÎ¯ÏƒÎ¿Î´Î¿/Î±Î»Î»Î±Î³Î® Î¼Î±Î³Î±Î¶Î¹Î¿Ï
        function initShop() {
            let savedShop = localStorage.getItem('activeShop');
            let name = prompt("Î£Îµ Ï€Î¿Î¹Î¿ Î¼Î±Î³Î±Î¶Î¯ Î¸Î­Î»ÎµÏ„Îµ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ;", savedShop || "");
            
            if (!name) {
                if (!savedShop) {
                    alert("Î ÏÎ­Ï€ÎµÎ¹ Î½Î± Î´ÏÏƒÎµÏ„Îµ Î­Î½Î± ÏŒÎ½Î¿Î¼Î±!");
                    location.reload();
                }
                name = savedShop;
            }

            currentShop = name.toLowerCase().trim();
            localStorage.setItem('activeShop', currentShop);
            document.getElementById('display-shop-name').innerText = "ğŸ¢ " + currentShop.toUpperCase();
            
            // Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… Server
            socket.emit('join-shop', currentShop);
        }

        function changeShop() {
            const confirmNew = confirm("Î˜Î­Î»ÎµÏ„Îµ Î½Î± Î±Î»Î»Î¬Î¾ÎµÏ„Îµ ÎºÎ±Ï„Î¬ÏƒÏ„Î·Î¼Î±;");
            if(confirmNew) {
                localStorage.removeItem('activeShop');
                location.reload();
            }
        }

        // Î‘ÏÏ‡Î¹ÎºÎ® ÎµÎºÎºÎ¯Î½Î·ÏƒÎ·
        initShop();

        socket.on('update-drivers', (drivers) => {
            const listDiv = document.getElementById('list');
            const driverIds = Object.keys(drivers);
            
            if (driverIds.length === 0) {
                listDiv.innerHTML = `<p style="color: #999; padding: 20px;">âŒ ÎšÎ±Î½Î­Î½Î±Ï‚ Î½Ï„ÎµÎ»Î¹Î²ÎµÏÎ¬Ï‚ online ÏƒÏ„Î¿ "${currentShop}"</p>`;
                return;
            }

            listDiv.innerHTML = "";
            driverIds.forEach(id => {
                listDiv.innerHTML += `
                    <div class="driver">
                        <span style="font-weight: bold; color: #333;">ğŸ‘¤ ${drivers[id]}</span>
                        <button class="btn-call" onclick="callDriver('${id}', '${drivers[id]}')">ğŸ”” ÎšÎ›Î—Î£Î—</button>
                    </div>`;
            });
        });

        function callDriver(id, name) {
            const time = new Date().toLocaleTimeString('el-GR', { hour: '2-digit', minute: '2-digit' });
            socket.emit('call-driver', { 
                driverId: id, 
                time: time, 
                shop: currentShop 
            });
            
            const status = document.getElementById('status');
            status.innerText = "Î‘Î½Î±Î¼Î¿Î½Î® Î±Ï€ÏŒ " + name + "...";
            status.style.background = "#fff3cd";
        }

        socket.on('driver-accepted', (data) => {
            const status = document.getElementById('status');
            status.innerText = "âœ… ÎŸ " + data.driverName + " Î•Î¡Î§Î•Î¤Î‘Î™!";
            status.classList.add('ok');
            successSound.play();

            setTimeout(() => {
                status.classList.remove('ok');
                status.innerText = "Î•Î¤ÎŸÎ™ÎœÎŸ Î“Î™Î‘ ÎšÎ›Î—Î£Î—";
                status.style.background = "#ececec";
            }, 8000);
        });
    </script>
</body>
</html>
