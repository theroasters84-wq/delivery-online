<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop Dashboard</title>
    <link rel="manifest" href="/manifest-shop.json">
    <style>
        body { background: #121212; color: white; font-family: sans-serif; text-align: center; padding: 20px; }
        .card { background: #1e1e1e; padding: 25px; border-radius: 20px; max-width: 450px; margin: auto; border: 1px solid #333; }
        .btn-main { background: #ffc107; color: black; padding: 15px; border-radius: 12px; font-weight: bold; width: 100%; border: none; cursor: pointer; }
        .driver-box { background: #2a2a2a; padding: 15px; margin: 12px 0; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid #ffc107; }
        .btn-call { background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        input { width: 90%; padding: 12px; margin: 8px 0; background: #000; color: white; border: 1px solid #444; text-align: center; }
    </style>
</head>
<body>

    <div class="card">
        <h2 style="color:#ffc107">ROASTERS SHOP</h2>
        <div id="login-section">
            <input type="text" id="sName" placeholder="ÎœÎ‘Î“Î‘Î–Î™">
            <input type="password" id="sPass" placeholder="ÎšÎ©Î”Î™ÎšÎŸÎ£">
            <button class="btn-main" onclick="doLogin()">Î•Î™Î£ÎŸÎ”ÎŸÎ£</button>
        </div>

        <div id="shop-section" style="display:none;">
            <div id="driver-list"><h4>Î‘ÎÎ‘Î–Î—Î¤Î—Î£Î— ÎŸÎ”Î—Î“Î©Î...</h4></div>
            <div id="status-box" style="margin-top:20px; color:#aaa; padding:10px; border-radius:8px;">ÎˆÏ„Î¿Î¹Î¼Î¿</div>
            <br>
            <button onclick="localStorage.clear(); location.reload();" style="color:#444; background:none; border:none; text-decoration:underline; cursor:pointer;">Logout</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let shopData = null;

        function doLogin() {
            const s = document.getElementById('sName').value.trim();
            const p = document.getElementById('sPass').value.trim();
            if(p !== "1234") return alert("Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚!");
            shopData = { shop: s, password: p, name: 'ÎšÎ•ÎÎ¤Î¡Î™ÎšÎŸ', isDriver: false };
            localStorage.setItem('shop_auth', JSON.stringify(shopData));
            location.reload();
        }

        socket.on('update-drivers-detailed', (drivers) => {
            const list = document.getElementById('driver-list');
            list.innerHTML = "<h4>ÎŸÎ”Î—Î“ÎŸÎ™ ONLINE</h4>";
            if(drivers.length === 0) list.innerHTML += "<p style='color:#555'>ÎšÎ±Î½Î­Î½Î±Ï‚ Î¿Î´Î·Î³ÏŒÏ‚</p>";
            drivers.forEach(d => {
                list.innerHTML += `<div class="driver-box"><span>ğŸ›µ <b>${d.name}</b></span><button class="btn-call" onclick="callDriver('${d.id}', '${d.name}')">ÎšÎ›Î—Î£Î—</button></div>`;
            });
        });

        function callDriver(id, name) {
            socket.emit('new-order', { shopName: shopData.shop, targetDriverId: id });
            document.getElementById('status-box').innerText = `ğŸ“¡ ÎšÎ»Î®ÏƒÎ· ÏƒÏ„Î¿Î½ ${name}...`;
            document.getElementById('status-box').style.background = "#333";
        }

        socket.on('order-confirmed', (data) => {
            const box = document.getElementById('status-box');
            box.innerText = `âœ… ÎŸ ${data.driverName} Î‘Î ÎŸÎ”Î•Î§Î¤Î—ÎšÎ•!`;
            box.style.background = "#28a745";
            box.style.color = "white";
        });

        window.onload = () => {
            const saved = localStorage.getItem('shop_auth');
            if(saved) {
                shopData = JSON.parse(saved);
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('shop-section').style.display = 'block';
                socket.emit('login', shopData);
            }
        };
    </script>
</body>
</html>
