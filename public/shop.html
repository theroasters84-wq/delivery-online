<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop Panel - The Roasters</title>
    <link rel="manifest" href="/manifest-shop.json">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/924/924514.png">
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; background: #f4f4f4; margin: 0; padding: 20px; }
        .card { max-width: 500px; margin: 20px auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .shop-badge { display: inline-block; background: #e67e22; color: white; padding: 8px 20px; border-radius: 50px; font-size: 1em; margin-bottom: 20px; font-weight: bold; cursor: pointer; }
        .driver { display: flex; justify-content: space-between; padding: 15px; border-bottom: 1px solid #eee; align-items: center; }
        .btn-call { background: #2ecc71; color: white; border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: bold; }
        #status { margin-top: 25px; padding: 20px; border-radius: 12px; font-weight: bold; background: #ececec; color: #666; font-size: 1.2em; border: 2px dashed #ccc; }
        .ok { background: #27ae60 !important; color: white !important; border: 2px solid #1e8449 !important; }
        .btn-switch { background: none; border: 1px solid #ccc; color: #888; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-top: 15px; }
    </style>
</head>
<body>

    <div class="card">
        <h2>Î Î¯Î½Î±ÎºÎ±Ï‚ Î¥Ï€ÎµÏÎ¸Ï…Î½Î·Ï‚</h2>
        <div class="shop-badge" id="display-shop-name" onclick="changeShop()">Î¦ÏŒÏÏ„Ï‰ÏƒÎ·...</div>
        
        <div id="list">
            <p style="color: #999;">Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î½Ï„ÎµÎ»Î¹Î²ÎµÏÎ¬Î´Ï‰Î½...</p>
        </div>

        <div id="status">Î•Î¤ÎŸÎ™ÎœÎŸ</div>
        
        <button class="btn-switch" onclick="changeShop()">ğŸ”„ Î‘Î»Î»Î±Î³Î® ÎœÎ±Î³Î±Î¶Î¹Î¿Ï</button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let currentShop = "";

        function initShop() {
            let savedShop = localStorage.getItem('activeShop');
            let name = prompt("Î£ÏÎ½Î´ÎµÏƒÎ· ÎœÎ±Î³Î±Î¶Î¹Î¿Ï (Ï€.Ï‡. roasters):", savedShop || "");
            
            if (!name) {
                if (!savedShop) { location.reload(); return; }
                name = savedShop;
            }

            currentShop = name.toLowerCase().trim();
            localStorage.setItem('activeShop', currentShop);
            document.getElementById('display-shop-name').innerText = "ğŸ¢ " + currentShop.toUpperCase();
            socket.emit('join-shop', currentShop);
        }

        function changeShop() {
            if(confirm("Î‘Î»Î»Î±Î³Î® ÎºÎ±Ï„Î±ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚;")) {
                localStorage.removeItem('activeShop');
                location.reload();
            }
        }

        initShop();

        socket.on('update-drivers', (drivers) => {
            const listDiv = document.getElementById('list');
            listDiv.innerHTML = "";
            const ids = Object.keys(drivers);
            
            if (ids.length === 0) {
                listDiv.innerHTML = `<p style="color: #999;">âŒ ÎšÎ±Î½Î­Î½Î±Ï‚ Î½Ï„ÎµÎ»Î¹Î²ÎµÏÎ¬Ï‚ online</p>`;
                return;
            }

            ids.forEach(id => {
                listDiv.innerHTML += `
                    <div class="driver">
                        <span style="font-weight: bold;">ğŸ‘¤ ${drivers[id]}</span>
                        <button class="btn-call" onclick="callDriver('${id}', '${drivers[id]}')">ğŸ”” ÎšÎ›Î—Î£Î—</button>
                    </div>`;
            });
        });

        function callDriver(id, name) {
            const time = new Date().toLocaleTimeString('el-GR', { hour: '2-digit', minute: '2-digit' });
            socket.emit('call-driver', { driverId: id, time: time, shop: currentShop });
            document.getElementById('status').innerText = "ÎšÎ»Î®ÏƒÎ· ÏƒÎµ " + name + "...";
        }

        socket.on('driver-accepted', (data) => {
            const s = document.getElementById('status');
            s.innerText = "âœ… " + data.driverName + " Î•Î¡Î§Î•Î¤Î‘Î™!";
            s.classList.add('ok');
            new Audio('https://actions.google.com/sounds/v1/notifications/positive_notification.ogg').play();
            setTimeout(() => { s.classList.remove('ok'); s.innerText = "Î•Î¤ÎŸÎ™ÎœÎŸ"; }, 8000);
        });
    </script>
</body>
</html>
