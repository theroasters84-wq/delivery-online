<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roasters Shop</title>
    <link rel="manifest" href="/manifest-shop.json">
    <style>
        body { background: #121212; color: white; font-family: sans-serif; text-align: center; padding: 20px; }
        .card { background: #1e1e1e; padding: 25px; border-radius: 20px; max-width: 450px; margin: auto; border: 1px solid #333; }
        .btn-main { background: #ffc107; color: black; padding: 15px; border-radius: 12px; font-weight: bold; width: 100%; border: none; cursor: pointer; }
        .driver-box { background: #2a2a2a; padding: 15px; margin: 12px 0; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid #ffc107; }
        .btn-call { background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        input { width: 90%; padding: 12px; margin: 8px 0; background: #000; color: white; border: 1px solid #444; text-align: center; }
    </style>
</head>
<body>

    <div class="card">
        <h2 style="color:#ffc107">SHOP DASHBOARD</h2>
        <div id="login-section">
            <input type="text" id="sName" placeholder="ÎœÎ‘Î“Î‘Î–Î™">
            <input type="password" id="sPass" placeholder="ÎšÎ©Î”Î™ÎšÎŸÎ£">
            <button class="btn-main" onclick="doLogin()">Î•Î™Î£ÎŸÎ”ÎŸÎ£</button>
        </div>

        <div id="shop-section" style="display:none;">
            <div id="driver-list"><h4>ÎŸÎ”Î—Î“ÎŸÎ™ ONLINE</h4></div>
            <div id="status-box" style="margin-top:20px; color:#aaa;">ÎˆÏ„Î¿Î¹Î¼Î¿</div>
            <br>
            <button onclick="localStorage.clear(); location.reload();" style="color:#444; background:none; border:none; text-decoration:underline;">Logout</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let shopData = null;

        function doLogin() {
            shopData = { shop: document.getElementById('sName').value.trim(), password: document.getElementById('sPass').value.trim(), name: 'ÎšÎ•ÎÎ¤Î¡Î™ÎšÎŸ', isDriver: false };
            if(shopData.password !== "1234") return alert("Î›Î¬Î¸Î¿Ï‚!");
            localStorage.setItem('shop_auth', JSON.stringify(shopData));
            location.reload();
        }

        socket.on('update-drivers-detailed', (drivers) => {
            const list = document.getElementById('driver-list');
            list.innerHTML = "<h4>ÎŸÎ”Î—Î“ÎŸÎ™ ONLINE</h4>";
            drivers.forEach(d => {
                list.innerHTML += `<div class="driver-box"><span>ðŸ›µ <b>${d.name}</b></span><button class="btn-call" onclick="callDriver('${d.id}', '${d.name}')">ÎšÎ›Î—Î£Î—</button></div>`;
            });
        });

        function callDriver(id, name) {
            socket.emit('new-order', { shopName: shopData.shop, targetDriverId: id });
            document.getElementById('status-box').innerText = `ðŸ“¡ ÎšÎ±Î»ÎµÎ¯Ï„Î±Î¹ Î¿ ${name}...`;
        }

        socket.on('order-confirmed', (data) => {
            document.getElementById('status-box').innerText = `âœ… ÎŸ ${data.driverName} Î‘Î ÎŸÎ”Î•Î§Î¤Î—ÎšÎ•!`;
            document.getElementById('status-box').style.color = "#28a745";
        });

        window.onload = () => {
            const saved = localStorage.getItem('shop_auth');
            if(saved) {
                shopData = JSON.parse(saved);
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('shop-section').style.display = 'block';
                socket.emit('login', shopData);
            }
        };

        if ('serviceWorker' in navigator) navigator.serviceWorker.register('/pwabuilder-sw.js');
    </script>
</body>
</html>
